Implementation notes.
## TODO: Write about the following things
- Overall algo
- Barrier tricks
- Static dispatch via enum
- No need to reset the state in a match-all
